# OdbDesign – repository summary

This repository contains a high‑performance C++ ODB++ parser library, a REST API server embedding the library, a small CLI app, and a comprehensive unit test suite. It targets Windows and Linux, uses CMake with presets, vcpkg manifest dependencies, GoogleTest, Crow (HTTP), OpenSSL, zlib, libarchive, and Protocol Buffers.

Repository URL: https://github.com/nam20485/OdbDesign

## Tech stack
- Languages: C++17
- Build: CMake (with presets), Ninja/MSVC/Clang/GCC
- Package manager: vcpkg (manifest mode via `vcpkg.json`)
- Testing: GoogleTest (FetchContent v1.16.0)
- Runtime/libs: Crow (HTTP server), OpenSSL, zlib, libarchive, Protocol Buffers
- Container: Dockerfile + compose.yml (server image)
- CI/CD: GitHub Actions (multi-platform CMake build, Docker build/publish, Docker Scout security scan, Dependency Review, SBOM upload). See badges/links in `docs/README.md`.

## Layout overview
- `OdbDesignLib/` – core ODB++ parser library and app/server infrastructure
  - `App/` – application base, args, auth; Protobuf initialization/teardown
  - `FileModel/` – ODB++ design file structures and parsers
  - `ProductModel/` – domain objects (Net, Component, etc.)
  - `ProtoBuf/` – generated protobuf C++ sources used by the library
- `OdbDesignServer/` – REST API server using Crow
  - `Controllers/` – HelloWorld, FileUpload, FileModel, HealthCheck, Designs
  - `main.cpp`, `OdbDesignServerApp.*`
- `OdbDesignApp/` – small CLI app linking the library
- `OdbDesignTests/` – unit tests (GTest), auto-discovered with `gtest_discover_tests`
- `Utils/` – shared utilities (logging, CLI args, JSON returnables, archive extract, file IO, cross‑platform helpers, etc.)
- `docs/` – detailed README, build/run guidance, API docs link
- `scripts/` – setup and helper scripts (Windows/PowerShell and Linux)
- Root config: `CMakeLists.txt`, `CMakePresets.json`, `vcpkg.json`, `vcpkg-configuration.json`, `Dockerfile`, `compose.yml`

Key targets
- Library: `OdbDesign` (SHARED)
- Executables: `OdbDesignServer`, `OdbDesignApp`, `OdbDesignTests`

## Bootstrap and build
Prefer CMake presets; they configure toolchains and vcpkg integration for you.

Build times and timeouts
- Configure+deps typically 2–3 minutes; compile 2–3 minutes; tests <1 minute. Don’t cancel long‑running steps in CI; allow 60+ minute timeout budget.

Windows (PowerShell)
- Optional one-time setup (installs/configures vcpkg, checks prerequisites):
  - `./scripts/setup-windows.ps1`
- Configure & build (Release):
  - `cmake --preset x64-release`
  - `cmake --build --preset x64-release`
- Configure & build (Debug):
  - `cmake --preset x64-debug`
  - `cmake --build --preset x64-debug`

Linux (bash)
- Automated dependency install (Ubuntu/Debian/Mint):
  - `./scripts/install-dependencies-deb.sh`
- Configure & build (Release):
  - `cmake --preset linux-release`
  - `cmake --build --preset linux-release`
- Configure & build (Debug):
  - `cmake --preset linux-debug`
  - `cmake --build --preset linux-debug`

Manual CMake (only if not using presets)
- Ensure vcpkg is installed and set `CMAKE_TOOLCHAIN_FILE` (example):
  - Windows: `-DCMAKE_TOOLCHAIN_FILE=%VCPKG_ROOT%\scripts\buildsystems\vcpkg.cmake`
  - Linux: `-DCMAKE_TOOLCHAIN_FILE=$VCPKG_ROOT/scripts/buildsystems/vcpkg.cmake`
- Example (Release out-of-source):
  - `cmake -S . -B out/build/release -DCMAKE_BUILD_TYPE=Release -DCMAKE_TOOLCHAIN_FILE=...`
  - `cmake --build out/build/release`

Artifacts
- Build output is under `out/build/<preset>` (e.g., `out/build/x64-release`). The server exe and library live here; copy dependent DLLs/SOs alongside if relocating binaries.

Notes/gotchas
- Warnings are elevated via CMake options; MSVC specific warnings 4251/4100 are suppressed where appropriate.
- OpenSSL, zlib, Crow, Protobuf are resolved via vcpkg; build will fail if toolchain is misconfigured. Prefer presets.
- Protobuf lifecycle is handled in `OdbDesignLib/App/OdbAppBase.*`.
- If vcpkg has transient network timeouts (e.g., bzip2/libarchive), you can install `libarchive-dev` via apt and continue; or run `vcpkg install --keep-going`.

## Test
- Tests are GoogleTest-based (`OdbDesignTests`). Build with your chosen preset then run tests.
- Run with CTest against the build tree:
  - Linux (bash): `ctest --test-dir ./out/build/linux-release --output-on-failure`
  - Windows (PowerShell): `ctest --test-dir .\out\build\x64-release --output-on-failure`
- Note: Some tests may require local test data; without it, a subset may fail.

## Run
CLI app
- After building, run `OdbDesignApp` from your build output folder (e.g., `./out/build/linux-release/OdbDesignApp/OdbDesignApp --help`).

Server
- After building, run `OdbDesignServer` from your build output folder.
  - Linux: `./out/build/linux-release/OdbDesignServer/OdbDesignServer --help` then `--port 8888`
- Endpoints/controllers include: HelloWorld, FileUpload, FileModel, HealthCheck, Designs.
- The server uses Crow; enable SSL and compression via compile defs (`CROW_ENABLE_SSL`, `CROW_ENABLE_COMPRESSION`). Provide certs/keys as configured in the app if enabling TLS. If you encounter runtime issues, smoke test with `--help` first.

Docker
- Build and run via Compose: `docker compose up`
  - Server: http://localhost:8888
  - Swagger UI (if exposed by compose): http://localhost:8080/swagger

## Validation/CI
- GitHub Actions pipelines build the project, build/publish Docker images, scan images (Docker Scout), perform dependency review, and upload SBOMs. See status badges and links in `docs/README.md`.
- Before committing significant changes, ensure:
  - Preset build succeeds in Release and Debug for your platform
  - Tests pass locally (`ctest ...`)
  - If touching server or container files, verify Docker build locally
  - Use generous timeouts in CI (60+ minutes) to avoid false timeouts on first builds

## Common issues and solutions
- vcpkg network failures: install `libarchive-dev` via apt as a fallback; then `vcpkg install --keep-going`.
- Protobuf compilation errors: regenerate via the vcpkg protoc:
  - `cd OdbDesignLib/protoc`
  - `$VCPKG_ROOT/../out/build/linux-release/vcpkg_installed/x64-linux/tools/protobuf/protoc --cpp_out=../ProtoBuf *.proto`
- Precompiled headers (PCH) issues: temporarily disable PCH in CMake if needed by editing the guard around `target_precompile_headers`.

## Where to make changes
- Parsing/data model: `OdbDesignLib/FileModel/*`, `OdbDesignLib/ProductModel/*`
- Server endpoints: `OdbDesignServer/Controllers/*` and `OdbDesignServer/OdbDesignServerApp.*`
- Shared utilities: `Utils/*`
- Public headers for consumers: `OdbDesignLib/*.h` (and subfolders)
- Tests: `OdbDesignTests/*`

## Configuration quick map
```
CMakeLists.txt                  # Main build configuration
CMakePresets.json               # Platform build presets
vcpkg.json                      # Dependency specification
vcpkg-configuration.json        # vcpkg registries and config
Dockerfile                      # Server container build
compose.yml                     # Docker Compose configuration
.github/workflows/              # CI/CD pipeline
docs/BUILD.md                   # Detailed build instructions
```

## Build output locations
```
out/build/linux-release/       # Linux release build
out/build/linux-debug/         # Linux debug build
out/build/x64-release/         # Windows release build
```

## Helpful links
- Repo: https://github.com/nam20485/OdbDesign
- Main docs: docs/README.md (includes build/run, security, CI, credits, contact)
- API docs (published site): https://nam20485.github.io/OdbDesign/api

Trust these instructions first. Only search if information is missing or observed to be inaccurate in your environment.